<style>
  .greenColor{color:#1d7b7b;}
  .grayColor{color:#434343;}
  .smallSize{font-size:0.875em;}
  .xsmallSize{font-size:0.5em;}

  .container-2{
    vertical-align: middle;
    white-space: nowrap;
    position: relative;
  }

  .container-2 input.search{width:100%; height: 34px; background: #d0e1e1; border: none; font-size: 0.8em; float: left; padding: 0 1em; -webkit-border-radius: 7px; -moz-border-radius: 7px; border-radius: 7px; color: #2a4949; -webkit-transition: width .55s ease; -moz-transition: width .55s ease; -ms-transition: width .55s ease; -o-transition: width .55s ease; transition: width .55s ease;}

  .container-2 input.search::-webkit-input-placeholder { color: #2a4949; }
  .container-2 input.search:-moz-placeholder { color: #2a4949; } /* Firefox 18- */
  .container-2 input.search::-moz-placeholder { color: #2a4949; } /* Firefox 19+ */
  .container-2 input.search:-ms-input-placeholder { color: #2a4949; }

  .select-style {
    font-size:1em;
    box-sizing: border-box;
    height:34px;
    vertical-align: middle;
    padding: 5px 0;
    width: 100%;
    border-radius: 7px;
    overflow: hidden;
    background: #d0e1e1 url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3hpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpjYTBjYjZhNC05ZWUxLTRjY2MtOTI2Ni1lNWRlYWYwZDJjYmMiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RTFBMUFFNTc0MDkwMTFFNThFMTlEOTVDMzg3QTFCM0YiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6RTFBMUFFNTY0MDkwMTFFNThFMTlEOTVDMzg3QTFCM0YiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpjYTBjYjZhNC05ZWUxLTRjY2MtOTI2Ni1lNWRlYWYwZDJjYmMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6Y2EwY2I2YTQtOWVlMS00Y2NjLTkyNjYtZTVkZWFmMGQyY2JjIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+uj7qhwAAAMNJREFUeNpi/P//P8NgBkwMgxyMOnDUgaMOHHXgqANHHTjqwIEFLKQo1vbyooqlV7dto2kITgPi/2TgafSK4lwg3keiHpD6PHo58C8QBwHxHSLVg9QFA/EfemaSj0DsCaUJqQMl3A8DkYvvQEPyL56QBoXc7YEsZvZB0yQ2AEpzewdDOTgditHFplGjSKJWQY2cs8nOsbR0ICxn76Akx1JckxCZs0dWXcw4OrIw6sBRB446cNSBow4cdeCoA4e0AwECDAAz8jJdfWe6pgAAAABJRU5ErkJggg==") no-repeat 100% 50%;
    cursor: pointer;
  }

  .select-style select {
    cursor: pointer;
    font-size:0.8em;
    color:#2a4949;
    padding: 5px 8px;
    width: 130%;
    border: none;
    box-shadow: none;
    background-color: transparent;
    background-image: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
  }

  .select-style select:focus {
    outline: none;
  }

  #mapContainer{width:100%; height:300px; background-color:#000000; color:#fff;}
  #browseBar{width:100%; background-color:#8ca9a9; height: 50px; box-sizing: border-box; padding:8px;}

  .groupRow{width:100%; background-color: #f1f8f8;}
  .groupRow:nth-child(even){background-color: #fff;}
  .imageColumn{display:inline-block; width: 120px; margin: 10px 5px 10px 10px; vertical-align: top;}
  .infoColumn{display:inline-block; width: 450px; margin: 10px 10px 10px 5px; vertical-align:top;}
  .infoTitle{width:100%; font-weight:800; font-size: 1em;}
  .infoTime{margin:0.5em 0;}
  .infoDistance{margin:0.5em 0;}
  .infoSummer{margin:0.5em 0;}
  .infoDescription{margin:0.5em 0; text-align:justify;}

  .pet{height:20px; width: 20px; background-repeat: no-repeat; vertical-align: sub; margin: 0 0.5em;}
  .cat{background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6M0M4QkQ5ODM0MDhFMTFFNThFMTlEOTVDMzg3QTFCM0YiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6M0M4QkQ5ODQ0MDhFMTFFNThFMTlEOTVDMzg3QTFCM0YiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDozQzhCRDk4MTQwOEUxMUU1OEUxOUQ5NUMzODdBMUIzRiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDozQzhCRDk4MjQwOEUxMUU1OEUxOUQ5NUMzODdBMUIzRiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqvuZNQAAANHSURBVHja5JvPSxRhGMefVrGLZkQFZQTeComopCi01AwMuqhpoH+AUBFdvFvHMIKkpM5SWFSHKDIq0ywpDIKSbhkRRlKxmpfEpO/XeWbZ1nL2x+zuzPt+4XNwGWefDzrzzvvO8644398vWUop2AsqQQUoB2VgNSjWY2ZBFEyCD2AcjIFRMJ2Nogp9Pt8mcAw0gT2gwOP4YoW/tzvu89/gJbgNboJPfhUY8ek8+8Fd8BF0g31JyC6XAj1Ht/7lee4DQRCuAcNgCBzJUHI5eZ77qX5XTT6EN4A+MAiqJXep1u/s0xpyItwC3oN2yV/atYaWbAoXgR5wQ+/A+U6p1sKaVvotXALug5MSvLCmh2CNX8Lr9Lo5KMENR4knWmtGwvy3eQB2SfCzHQx4XW4Rj2uWA/9OCU92aM1F6QhfAHUSvtRp7SkJ83Z/XMIb1t6arDAf8K9K+HNFn9E9hXt0RhP20OGil3AtaBRz0pg4nCYKnxXz0vU/YQ7eVQYKV6nbEuFOMTedicLrQYPBwg3qGBNuE/+Xe4KUQnWMCTeL+Wl2hd3VRdNDx1IKZ7rgFpYsLgxGQjYbyjSVFN5mkXAFhcstEi6n8EaLhMsihsyMks0qChdbJFwSEbsyR+FZi4RnKRy1SPgnhSctEv5K4QmLhCco/M4i4XEKv7ZIeIzCL8TpqTA9dBylMLtlRi0QpmPUffC4ZYHwoqMrfA3MGyw7r44x4Slx3q2amgF1/Gtd+pzBwjG3eGH2QI0YKDuibkuEmS4Dhc/E/5Ao/BjcMUiWLo+WE2ZOGTKDiqqLeAl/Bh0GCHeoi6cwww633hDL9qqDJCvMnBangzVsGdbaJVXhOXAUvA2RLGtt0tpTFma+g3rwJiSy9VqzpCvsPnayG30wwLLPxGkcn/I6MNll2hlwGFwKoOxlcAj8SObgVNalf4nTqtsqWdpxkmJmtJYTWpv4LeyGu0y2utOtPOU62KK1pJR03zx8EacNvzbHE47n4jSPtmkNkithNxynq/WGcQ8sZEFyQc/N76jK9ObpV+fOkLJZryuOhdx4lW4rBRfcXonT+8wnJt82avndqsTCupX4rXjsMuCL97Xy761438R5IcCxNKtb8f4IMABU6Jh7i9wwgAAAAABJRU5ErkJggg=="); background-size: 100%;}
  .dog{background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6M0M4QkQ5ODM0MDhFMTFFNThFMTlEOTVDMzg3QTFCM0YiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6M0M4QkQ5ODQ0MDhFMTFFNThFMTlEOTVDMzg3QTFCM0YiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDozQzhCRDk4MTQwOEUxMUU1OEUxOUQ5NUMzODdBMUIzRiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDozQzhCRDk4MjQwOEUxMUU1OEUxOUQ5NUMzODdBMUIzRiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqvuZNQAAANHSURBVHja5JvPSxRhGMefVrGLZkQFZQTeComopCi01AwMuqhpoH+AUBFdvFvHMIKkpM5SWFSHKDIq0ywpDIKSbhkRRlKxmpfEpO/XeWbZ1nL2x+zuzPt+4XNwGWefDzrzzvvO8644398vWUop2AsqQQUoB2VgNSjWY2ZBFEyCD2AcjIFRMJ2Nogp9Pt8mcAw0gT2gwOP4YoW/tzvu89/gJbgNboJPfhUY8ek8+8Fd8BF0g31JyC6XAj1Ht/7lee4DQRCuAcNgCBzJUHI5eZ77qX5XTT6EN4A+MAiqJXep1u/s0xpyItwC3oN2yV/atYaWbAoXgR5wQ+/A+U6p1sKaVvotXALug5MSvLCmh2CNX8Lr9Lo5KMENR4knWmtGwvy3eQB2SfCzHQx4XW4Rj2uWA/9OCU92aM1F6QhfAHUSvtRp7SkJ83Z/XMIb1t6arDAf8K9K+HNFn9E9hXt0RhP20OGil3AtaBRz0pg4nCYKnxXz0vU/YQ7eVQYKV6nbEuFOMTedicLrQYPBwg3qGBNuE/+Xe4KUQnWMCTeL+Wl2hd3VRdNDx1IKZ7rgFpYsLgxGQjYbyjSVFN5mkXAFhcstEi6n8EaLhMsihsyMks0qChdbJFwSEbsyR+FZi4RnKRy1SPgnhSctEv5K4QmLhCco/M4i4XEKv7ZIeIzCL8TpqTA9dBylMLtlRi0QpmPUffC4ZYHwoqMrfA3MGyw7r44x4Slx3q2amgF1/Gtd+pzBwjG3eGH2QI0YKDuibkuEmS4Dhc/E/5Ao/BjcMUiWLo+WE2ZOGTKDiqqLeAl/Bh0GCHeoi6cwww633hDL9qqDJCvMnBangzVsGdbaJVXhOXAUvA2RLGtt0tpTFma+g3rwJiSy9VqzpCvsPnayG30wwLLPxGkcn/I6MNll2hlwGFwKoOxlcAj8SObgVNalf4nTqtsqWdpxkmJmtJYTWpv4LeyGu0y2utOtPOU62KK1pJR03zx8EacNvzbHE47n4jSPtmkNkithNxynq/WGcQ8sZEFyQc/N76jK9ObpV+fOkLJZryuOhdx4lW4rBRfcXonT+8wnJt82avndqsTCupX4rXjsMuCL97Xy761438R5IcCxNKtb8f4IMABU6Jh7i9wwgAAAAABJRU5ErkJggg=="); background-size: 100%;}
  .pet.yes{display:inline-block;}
  .pet.no{display:none;}

  .community_group_search_block{font-family: Verdana;width:600px;margin: auto;}
  .group_signup_link{display: none; color: #02BBBB;}

  .gmap_infoblock{font-family: Verdana; color: #888; max-width: 300px; font-size: 11px;}
  .gmap_infoblock_title{font-weight: bold; color: #666;}
  .gmap_infoblock_address{margin: 10px 0;}
  .gmap_infoblock>ul{margin: 0; padding: 0; list-style: none;}
  .gmap_infoblock>ul>li>span:first-child{font-weight: bold; color: #666;}
  .gmap_infoblock_link{margin-left: 10px;}
  .search_message{display: none; background: #d0e1e1; border-radius: 7px; border: 2px solid #8ca9a9; bottom: 14px; color: #2a4949; padding: 5px 15px; position: absolute; z-index: 98; font-size: 0.8em; left: 11px;}
  .search_message:before{border: solid; border-color: #8ca9a9 transparent; border-width: 6px 6px 0 6px; bottom: -8px; content: ''; left: 47%; position: absolute; z-index: 99;}
</style>

<script>
  (function ($) {

    var worksheetIds = {
      groups: 'oeif2vi',
      links: 'ovbc8ql'
    };

    var gmap; // google map instance
    var geocoder; // google geocoder instance


    var geocodingAreaCenter = [  // Los Angeles, CA 90028, USA
      34.1012181, -118.325739
    ];
    var geocodingAreaRadius = 50;  // (in miles) defines area within this radius from geocodingAreaCenter


    var addressLastSearch; // remembers last user's address searched
    var curAddressMarker; // found user's location marker

    var groupSignupTpl;
    var groupTypes = {};
    var groupSheetColumnsAssign = { // helps to find which and where data have to be put
      'gsx$firstname': {type: 'text', sel: '.profile_firstname'},
      'gsx$lastname': {type: 'text', sel: '.profile_lastname'},
      'gsx$photourl': {type: 'attr', modName: 'src', sel: '.profile_image'},
      'gsx$grouptype': {type: 'text', sel: '.infoTitle_grouptype'},
      'gsx$grouptitle': {type: 'text', sel: '.infoTitle_grouptitle'},
      'gsx$frequency': {type: 'text', sel: '.infoTime_frequency'},
      'gsx$day': {type: 'text', sel: '.infoTime_day'},
      'gsx$time': {type: 'text', sel: '.infoTime_time'},
      'gsx$cat': {type: 'class', sel: '.cat', classes: {Yes: 'yes', No: 'no'}},
      'gsx$dog': {type: 'class', sel: '.dog', classes: {Yes: 'yes', No: 'no'}},
      'gsx$description': {type: 'text', sel: '.infoDescription'},
      'gsx$address': {type: 'text', sel: '.infoTitle_address'},
      'gsx$activeinsummer': {type: 'text', sel: '.infoSummer_bool'},
    };


    /**
     * request sheet data
     * @param clb
     */
    var getSheetData = function (sheetAlias, clb) {
      var spreadSheetId = '10l5ejQ_19dVvr_R0uNMhT5svINJdht4SZFEKj5L0WJ0';
      var sheetId = worksheetIds[sheetAlias];
      var url = 'https://spreadsheets.google.com/feeds/list/' + spreadSheetId + '/' + sheetId + '/public/full';

      $.ajax({
        url: url,
        data: {
          alt: 'json'
        },
        success: clb
      });
    };


    var insertGroupDiv = function (data, rowDiv, parentEl) {
      if (data['gsx$verified'] && data['gsx$verified']['$t'] && data['gsx$verified']['$t'] == '1') {
        var gmapInfoContent = $('.gmap_infoblock_wrap').clone();
        $.each(data, function (colName, obj) {
          if (groupSheetColumnsAssign[colName]) {
            var colParams = groupSheetColumnsAssign[colName];
            var colValue = obj['$t'];
            switch (colParams['type']) {
              case 'text':
                $(rowDiv).find(colParams.sel).text(colValue);
                gmapInfoContent.find(colParams.sel).text(colValue);
                break;
              case 'attr':
                rowDiv.find(colParams.sel).attr(colParams.modName, colValue);
                if( colParams.modName == 'src' && !colValue ){ // remove image if src empty
                  rowDiv.find(colParams.sel).remove();
                }
                break;
              case 'class':
                if (colParams.classes[colValue]) {
                  rowDiv.find(colParams.sel).addClass(colParams.classes[colValue]);
                }
                break;
            }
            rowDiv.data(colName.replace(/^gsx\$/, ''), colValue);
          }
          if (colName == 'gsx$latitude') {
            rowDiv.data('lat', parseFloat(obj['$t']));
          }
          if (colName == 'gsx$longitude') {
            rowDiv.data('lng', parseFloat(obj['$t']));
          }
        });

        if( !rowDiv.data('lat') || !rowDiv.data('lng') ||
            !rowDiv.data('grouptype') || !rowDiv.data('grouptype') ){
          return;
        }

        var gt = rowDiv.data('grouptype');
        groupTypes[gt] = gt;

        if( groupSignupTpl ){
          var href = groupSignupTpl.template.replace(groupSignupTpl.pattern, rowDiv.find('.infoTitle_grouptitle').text());
          rowDiv.find('.group_signup_link')
              .attr('href', href)
              .show();
          gmapInfoContent.find('.group_signup_link')
              .attr('href', href)
              .show();
        }

        attachMarker(rowDiv, gmapInfoContent.html());
        rowDiv.appendTo(parentEl).show();
      }
    };

    /**
     * parse received sheet data of available groups and build list of html blocks
     * @param d
     */
    var parseGroupsSheetData = function (d) {
      if (d && d.feed && d.feed.entry && d.feed.entry.length) {
        var gr = $('.groupRow:eq(0)');
        var groupParent = $('.groupRows');
        $.each(d.feed.entry, function (i, rowData) {
          insertGroupDiv(rowData, gr.clone(), groupParent);
        });
        $.each(groupTypes, function (v, groupName) {
          $('<option/>', {
            value: groupName,
            text: groupName
          }).appendTo('.grouptypes');
        });
        gr.remove();
      }
      filterList('');
    };

    /**
     * parse received sheet data of sign up form links and fill hrefs of links
     * @param d
     */
    var parseLinksSheetData = function (d) {
      if (d && d.feed && d.feed.entry && d.feed.entry.length) {
        $.each(d.feed.entry, function (i, rowData) {
          if( rowData['gsx$formtype']['$t'] == 'Member Signup' ){
            groupSignupTpl = {
              template: rowData['gsx$url']['$t'],
              pattern: new RegExp("\<GroupTitleFromQuery\>")
            };
          }
        });
      }
    };

    /**
     * filtering groups list
     * @param groupType - group type
     * @param address - string of address
     */
    var filterList = function (address) {
      try {
        var groupType = $('.grouptypes').val();
        if (typeof groupType !== 'undefined') {
          if (groupType) {
            $('.groupRow').each(function (i, v) {
              if ($(v).data('grouptype') == groupType) {
                $(v).show();
                showMarker(v);
              } else {
                $(v).hide();
                hideMarker(v);
              }
            });
          } else {
            $('.groupRow').each(function (i, v) {
              $(v).show();
              showMarker(v);
            });
          }
        }


        if (address) {
          if (addressLastSearch == address) {
            return;
          }
          if (curAddressMarker) {
            curAddressMarker.setMap(null);
          }
          addressLastSearch = address;
          getLocation(address, function (res) { try {
            if (res && res.length) {
              var location = res[0].geometry.location;
              // check if location found is in permitted geocodin area
              if (calcDistance(location.G, location.K, geocodingAreaCenter[0], geocodingAreaCenter[1]) > geocodingAreaRadius) {
                $('.search_message').fadeIn(200, function () {
                  setTimeout(function () {
                    $('.search_message').fadeOut(200)
                  }, 1500);
                });
                return;
              }

              var forthDist = 0;

              // calculating distances and updating group rows
              $('.groupRow').each(function (i, v) {
                var dist = calcDistance($(v).data('lat'), $(v).data('lng'), location.G, location.K);
                $(v).data('distance', dist);
                $(v).find('.infoDistance_amount').text(Math.round(dist) || "<1");
                $(v).find('.infoDistance_miles').show();
              });

              // sorting groups rows by distance ascending
              var parent = $('.groupRows').parent();
              $(parent).find('.groupRow').sort(function (a, b) {
                return $(a).data('distance') > $(b).data('distance') ? 1 : -1;
              }).appendTo(parent);

              // calculating distance to 4th group location
              $('.groupRow').each(function (i, v) {
                if (i < 4) {
                  forthDist = $(v).data('distance');
                }
              });

              // setting center and zoom of map
              gmap.setCenter(location);
              if (forthDist > 0) {
                var zoom = Math.round(13 - Math.log(forthDist) / Math.LN2);
                gmap.setZoom(zoom);
              }

              // creating marker on found address location
              curAddressMarker = new google.maps.Marker({
                position: {lat: location.G, lng: location.K},
                icon: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB98IGg4JGZ9fxuMAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAADoElEQVQ4y43UTU/bWBTG8X9cJyTYqXF4LxTSDgyJEApUzCbTYdNKiG0XILHgK8BHoV+h+5lZzBIolapWAgoIkYgXpUwDCQ0kITixk8Z2nC4q3GZmMXOlu7w/3XPOvY/nr4Mmd8u2LcqlPLWqPhJs9y4NdLU/VyRvxCsKimU7mmZYx9lCdb1StV55fW0pRe2mzd/unvfcYV9qBrfFK+Q2z+qTsc7lR30yXlHgn8uyHf7O6eydFF+Wa/ZKUOkkqIQAEO+gUv5z76N+6Y/fJnribb57nJ+fk06nqVQqlMtlJElClmWGh4f5+fFjhnuk5beH1798vCy8aDadq/sdXXj+3DUp5C4I9wbePXvSHzcMnd3dXS4uLnAch2azieM47m40GgwNDRGPx1GUDjb2Pr//eFn5NdTVj1gu5ZHaPKszsd54tWqwtraGYRg4jsPU1BSjo6P4/X4Astksm5ubnJ2dkc1mmZ+fZybWG8/fflnVSvkVoVbVR6bHOpdFAXZ2dlwoEokwMTGB3++nXq8DMDAwwOzsLI1GA13X2djY4J6nyfRY53KjYY+IckBcCvfJZDIZMpmMW1o0GgXg8PCQvb09VFVlbm4OVVXdklOpFKenp4yMjiEHxCXhYbf03CsKpNPplh7dlXZycoJhGJyfn6PrOoDbO8uySCQSeEWBh93Sc1GRfREATdNamq3rOqqqMj4+Tr1eR1VVgsEgzWbThUzTJJfLAaDIvojoEwUFoFKptEwtmUzy9OlTotGoWzJAPp93oR8xnygogmk7GoAkSS3jTyQSlEqlfz3azc1NFzJNk46ODgBM29EETTePAWRZdiHHcbBtm/39/RYom82STCZdyLIsQqFvr1/TzWPhIm+sW7ZDOBx2oTs0mUxSLBZd7M2bNy2QbdtMTk5i2Q4XeWNd0Gv2q085nXA4zODgYMvtTNNke3sbgHQ6TSKRaIEikQixWIxPOR29Zr8SvL621IeT4kvbgZmZGQKBQMvtDg4OKBQKbG1ttUDBYJDFxUUcBD6cFF8KHiHl+X27SuEqw+N++d2zJ/1xTbvl9evXpFIpd2qhUIjLy0tqtRq2bRONRllYWKC7u8f9m/eVzm8RVNFuKN8Wen96EHRT4+joiEQiwfX1NblcDkVRUFWVWCzG9PQ0dbPB28Pr9x8vKy/8Aekq1P3ge56VbwtUtBuUdu//zjOtaq34AxJqVx+CcO87dpdr2s01tm39Z9J6PJ7Uj8EI8BVjfHimYeey8AAAAABJRU5ErkJggg==",
                map: gmap,
                title: address
              });
            }
          } catch(er){}});
        }
      } catch(er){}
    };


    /**
     * attach marker to group div
     * @param rowdiv
     */
    var attachMarker = function(rowDiv, content){
      var infowindow = new google.maps.InfoWindow({
        content: content
      });
      var marker = new google.maps.Marker({
        position: {lat: $(rowDiv).data('lat'), lng: $(rowDiv).data('lng')},
        title: $(rowDiv).data('grouptitle')
      });

      marker.addListener('click', function () {
        $('.groupRow').each(function (i, v) {
          var iw = $(v).data('infowindow');
          iw.close();
        });
        infowindow.open(gmap, marker);
      });

      rowDiv.data('marker', marker);
      rowDiv.data('infowindow', infowindow);
      return marker;
    };


    var showMarker = function(rowDiv){
      var marker = $(rowDiv).data('marker');
      marker.setMap(gmap);
    };

    var hideMarker = function(rowDiv){
      var marker = $(rowDiv).data('marker');
      marker.setMap(null);
    };

    /**
     * request coordinates from google geocoder for specified address
     * @param address
     * @param clb
     */
    var getLocation = function(address, clb){
      geocoder.geocode( { 'address': address, componentRestrictions: { country: 'US'}}, function(results, status) {
        if (status == google.maps.GeocoderStatus.OK) {
          clb(results)
        }
      });
    };

    /**
     * haversine formula for calculating distance for two points on map
     * @returns {number} - distance in miles
     */
    var calcDistance = function(){
      var radians = Array.prototype.map.call(arguments, function(deg) { return deg/180.0 * Math.PI; });
      var lat1 = radians[0], lon1 = radians[1], lat2 = radians[2], lon2 = radians[3];
      //var R = 6372.8; // km
      var R = 3959.87; // miles
      var dLat = lat2 - lat1;
      var dLon = lon2 - lon1;
      var a = Math.sin(dLat / 2) * Math.sin(dLat /2) + Math.sin(dLon / 2) * Math.sin(dLon /2) * Math.cos(lat1) * Math.cos(lat2);
      var c = 2 * Math.asin(Math.sqrt(a));
      return R * c;
    };


    window.gmap_init = function(){
      try{
        gmap = new google.maps.Map(document.getElementById('mapContainer'), {
          center: {lat: 34.0204989, lng: -118.4117325},
          zoom: 9
        });

        geocoder = new google.maps.Geocoder();

        $(document).ready(function(){
          // run
          getSheetData('links', function (d) {
            try {
              parseLinksSheetData(d);
              getSheetData('groups', function(d_){
                try {
                  parseGroupsSheetData(d_);
                } catch( er ){}
              });
            } catch( er ){}
          });

          // group types select box event
          $('.grouptypes').change(function () {
            filterList();
          });

          $('.community_group_search_block')
              .on('click', '.groupRow', function () { // group block click event
                new google.maps.event.trigger($(this).data('marker'), 'click');
              })
              .on('keypress', '.search', function (ev) {  // search input box 'Enter' pressing event
                if (ev.which == 13) {
                  filterList($(this).val());
                }
              })
              .on('blur', '.search', function () {  // search input box loosing focus event
                filterList($(this).val());
              });
        });

      } catch( er ){}

      // TODO: remove before deploy
      if( window.location.href.match('\.*showArea=1') ){
        // Create marker
        var marker = new google.maps.Marker({
          map: gmap,
          position: new google.maps.LatLng(34.1012181, -118.325739)
        });

        var circle = new google.maps.Circle({
          map: gmap,
          radius: 80465,    // 50 miles
          fillColor: '#bbb',
          strokeColor: '#999',
          strokeWeight: 1
        });
        circle.bindTo('center', marker, 'position');
      };

    };

    // get google maps api
    $.getScript("//maps.googleapis.com/maps/api/js?key=AIzaSyBOJpoDfc07UlLA0uTl5a8c9Wd87WlfyAg&libraries=places&callback=gmap_init");
  })(jQuery);
</script>

<div class="community_group_search_block">

  <div id="mapContainer"></div>

  <div id="browseBar">
    <div style="display:inline-block; width:30%;">
      <div class="box">
        <div class="container-2">
          <input type="search" class="search" placeholder="Enter your Zip Code" />
          <div class="search_message">Address not found</div>
        </div>
      </div>
    </div>
    <div style="display:inline-block; width:25%; float:right;">
      <div class="select-style">
        <select class="grouptypes">
          <option value="">Group Type</option>
        </select>
      </div>
    </div>
  </div>

  <div class="groupRows" style="width:100%;">

    <div class="groupRow" style="display: none;">
      <div class="imageColumn">
        <img class="profile_image" src="" style="width:100%;">
        <div class="xsmallSize greenColor">
          <span class="profile_firstname"></span>
          <span class="profile_lastname"></span>
        </div>
      </div><div class="infoColumn">
      <div class="infoTitle">
        <span class="infoTitle_grouptype"></span>:
        <span class="infoTitle_grouptitle"></span>
      </div>
      <div class="infoTime smallSize">
        <span class="grayColor">Meeting </span>
        <span class="greenColor infoTime_frequency"></span>
        <span class="grayColor"> on </span>
        <span class="greenColor infoTime_day"></span>
        <span class="grayColor"> at </span>
        <span class="greenColor infoTime_time"></span>
      </div>
      <div class="infoDistance smallSize">
        <div style="display: inline-block">
          <div class="infoDistance_miles" style="display: none;">
            <span class="greenColor infoDistance_amount"></span>
            <span class="grayColor"> Miles Away</span>
          </div>
        </div>
        <div class="pet cat"></div>
        <div class="pet dog"></div>
        <div style="display: inline-block; float: right;">
          <a class="group_signup_link" href="#" target="_blank">Sign up</a>
        </div>
      </div>
      <div class="infoSummer smallSize grayColor">
        Active in Summer: <span class="infoSummer_bool greenColor">No</span>
      </div>
      <div class="infoDescription smallSize"></div>
    </div>
    </div>

  </div>


  <div class="gmap_infoblock_wrap" style="display: none;">
    <div class="gmap_infoblock">
      <div class="gmap_infoblock_title ">
        <span class="infoTitle_grouptitle"></span> <a class="gmap_infoblock_link group_signup_link" href="#" target="_blank">Sign up</a>
      </div>
      <div class="gmap_infoblock_address infoTitle_address"></div>
      <ul>
        <li><span>Frequency: </span><span class="infoTime_frequency"></span></li>
        <li><span>Day: </span><span class="infoTime_day"></span></li>
        <li><span>Time: </span><span class="infoTime_time"></span></li>
        <li><span>Active in Summer: </span><span class="infoSummer_bool"></span></li>
        <li><span>Brief Description: </span><span class="infoDescription"></span></li>
      </ul>

    </div>
  </div>
</div>